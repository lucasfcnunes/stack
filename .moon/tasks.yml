# https://moonrepo.dev/docs/config/tasks
$schema: 'https://moonrepo.dev/schemas/tasks.json'

fileGroups:
  go:
    - '**/*.go'

tasks:
  # Global task for Go project
  go:
    description: 'Run all Go tasks'
    deps: ['go/modtidy', 'go/imports', 'go/fmt', 'go/lint', 'go/test']
    command: 'echo "Running all Go tasks"'
    inputs:
      - '@group(go)'

  # All task for Go Project
  go/modtidy:
    command: 'go mod tidy'
    inputs:
      - '@group(go)'

  go/imports:
    command: 'goimports -w .'
    inputs:
      - '@group(go)'

  go/fmt:
    command: 'gofmt -w .'
    inputs:
      - '@group(go)'

  go/lint:
    command: 'golangci-lint run --fix --allow-parallel-runners'
    affectedFiles: true
    inputs:
      - '@group(go)'

  go/test:
    command: 'go test -race -coverpkg ./... -coverprofile coverage.out ./...'
    affectedFiles: true
    inputs:
      - '@group(go)'
